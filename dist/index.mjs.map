{"version":3,"sources":["../src/command-options.ts","../src/error.ts","../src/modal-fields.ts"],"sourcesContent":["import { APIApplicationCommandInteractionDataOption, ApplicationCommandOptionType, InteractionType } from \"discord-api-types/v10\";\nimport { ApplicationCommandOptionResolutionError } from \"./error\";\n\ntype ApplicationCommandInteractionTypes = InteractionType.ApplicationCommand | InteractionType.ApplicationCommandAutocomplete;\ntype ExtractedOption<CommandInteractionType extends ApplicationCommandInteractionTypes, OptionType extends ApplicationCommandOptionType> = Extract<APIApplicationCommandInteractionDataOption<CommandInteractionType>, { type: OptionType; }>;\nexport type SubcommandOptionType = ApplicationCommandOptionType.Subcommand | ApplicationCommandOptionType.SubcommandGroup;\nexport type FocusableOptionType = Extract<APIApplicationCommandInteractionDataOption<InteractionType.ApplicationCommandAutocomplete>, { focused?: boolean }>[\"type\"];\nexport type AutocompleteFocusedOption<OptionType extends FocusableOptionType = FocusableOptionType> = Omit<ExtractedOption<InteractionType.ApplicationCommandAutocomplete, OptionType>, \"focused\"> & { focused: true };\ninterface BaseGetOptionQuery<OptionType extends ApplicationCommandOptionType> {\n    name: string;\n    type: OptionType;\n}\ninterface RequiredOption<Required extends boolean = boolean> {\n    required: Required;\n}\n\nfunction isFocusedOption(option: APIApplicationCommandInteractionDataOption): option is AutocompleteFocusedOption {\n    return \"focused\" in option && !!option.focused;\n}\n\nexport class ApplicationCommandOptions<CommandInteractionType extends ApplicationCommandInteractionTypes> {\n    private readonly _options: Map<string, APIApplicationCommandInteractionDataOption<CommandInteractionType>>;\n    private _subcommand: string | null;\n    private _group: string | null;\n    private _focused: string | null;\n\n    private mapOptions(options: APIApplicationCommandInteractionDataOption<CommandInteractionType>[] | undefined): void {\n        options?.forEach(option => {\n            switch (true) {\n                case option.type === ApplicationCommandOptionType.Subcommand: this._subcommand = option.name; break;\n                case option.type === ApplicationCommandOptionType.SubcommandGroup: this._group = option.name; break;\n                default:\n                    if (isFocusedOption(option)) {\n                        this._focused = option.name;\n                    }\n                    this._options.set(option.name, option);\n                    break;\n            }\n            if (\"options\" in option) {\n                this.mapOptions(option.options);\n            }\n        });\n    }\n\n    constructor(options?: APIApplicationCommandInteractionDataOption<CommandInteractionType>[]) {\n        this._options = new Map<string, APIApplicationCommandInteractionDataOption<CommandInteractionType>>();\n        this._subcommand = null;\n        this._group = null;\n        this._focused = null;\n        this.mapOptions(options);\n    }\n\n    get<OptionType extends Exclude<ApplicationCommandOptionType, SubcommandOptionType>>(query: BaseGetOptionQuery<OptionType> & RequiredOption<true>): ExtractedOption<CommandInteractionType, OptionType>;\n    get<OptionType extends Exclude<ApplicationCommandOptionType, SubcommandOptionType>>(query: BaseGetOptionQuery<OptionType> & Partial<RequiredOption>): ExtractedOption<CommandInteractionType, OptionType> | null;\n    get<OptionType extends Exclude<ApplicationCommandOptionType, SubcommandOptionType>>(query: BaseGetOptionQuery<OptionType> & Partial<RequiredOption>): ExtractedOption<CommandInteractionType, OptionType> | null {\n        const option = this._options.get(query.name) ?? null;\n        if (query.required && !option) {\n            throw new ApplicationCommandOptionResolutionError(`Unable to find required option: ${query.name}`);\n        }\n        if (option && option.type !== query.type) {\n            throw new ApplicationCommandOptionResolutionError(`Expected option type ${ApplicationCommandOptionType[query.type]}. Received: ${ApplicationCommandOptionType[option.type]}`);\n        }\n        return <ExtractedOption<CommandInteractionType, OptionType> | null>option;\n    }\n\n    get subcommand(): string | null {\n        return this._subcommand;\n    }\n\n    get group(): string | null {\n        return this._group;\n    }\n\n    getFocused(): AutocompleteFocusedOption {\n        if (!this._focused) {\n            throw new ApplicationCommandOptionResolutionError(\"Unabled to find focused option\");\n        }\n        return <AutocompleteFocusedOption>this._options.get(this._focused)!;\n    }\n}\n\nfunction findOption<T extends APIApplicationCommandInteractionDataOption>(options: APIApplicationCommandInteractionDataOption[] | undefined, test: (option: APIApplicationCommandInteractionDataOption) => option is T): T | null;\nfunction findOption(options: APIApplicationCommandInteractionDataOption[] | undefined, test: (option: APIApplicationCommandInteractionDataOption) => boolean): APIApplicationCommandInteractionDataOption | null;\nfunction findOption(options: APIApplicationCommandInteractionDataOption[] | undefined, test: (option: APIApplicationCommandInteractionDataOption) => boolean): APIApplicationCommandInteractionDataOption | null {\n    if (options) {\n        for (const option of options) {\n            if (test(option)) {\n                return option;\n            }\n            if (\"options\" in option) {\n                const found = findOption(option.options, test);\n                if (found) {\n                    return found;\n                }\n            }\n        }\n    }\n    return null;\n}\n\nexport function getSubcommand(options: APIApplicationCommandInteractionDataOption<InteractionType.ApplicationCommand>[] | undefined): string | null {\n    const subcommand = findOption(options, option => option.type === ApplicationCommandOptionType.Subcommand);\n    return subcommand?.name ?? null;\n}\n\nexport function getGroup(options: APIApplicationCommandInteractionDataOption<InteractionType.ApplicationCommand>[] | undefined): string | null {\n    const group = findOption(options, option => option.type === ApplicationCommandOptionType.SubcommandGroup);\n    return group?.name ?? null;\n}\n\nexport function getFocusedOption(options: APIApplicationCommandInteractionDataOption<InteractionType.ApplicationCommandAutocomplete>[] | undefined): AutocompleteFocusedOption {\n    const focused = findOption(options, isFocusedOption);\n    if (!focused) {\n        throw new ApplicationCommandOptionResolutionError(\"Unabled to find focused option\");\n    }\n    return focused;\n}\n","class CustomError extends Error {\n    constructor(message: string) {\n        super(message);\n        this.name = this.constructor.name;\n    }\n}\n\nexport class ApplicationCommandOptionResolutionError extends CustomError { }\nexport class ModalFieldResolutionError extends CustomError { }\n","import { APIModalSubmissionComponent, ComponentType, ModalSubmitComponent } from \"discord-api-types/v10\";\nimport { ModalFieldResolutionError } from \"./error\";\n\ninterface FindModalFieldQuery<Type extends ModalSubmitComponent[\"type\"]> {\n    type: Type;\n    customId: string;\n}\n\nexport function findModalField<Type extends ModalSubmitComponent[\"type\"]>(components: APIModalSubmissionComponent[], options: FindModalFieldQuery<Type>): Extract<ModalSubmitComponent, { type: Type }> {\n    for (const field of components) {\n        let component: ModalSubmitComponent | null = null;\n        switch (field.type) {\n            case ComponentType.ActionRow: component = field.components.find(component => component.custom_id === options.customId) ?? null; break;\n            case ComponentType.Label: component = field.component; break;\n        }\n        if (component) {\n            if (component.type !== ComponentType.TextInput) {\n                throw new ModalFieldResolutionError(`Modal field is not of type ${options.type}: ${options.customId}`);\n            }\n            return component as Extract<ModalSubmitComponent, { type: Type }>;\n        }\n    }\n    throw new ModalFieldResolutionError(`Unable to find modal field: ${options.customId}`);\n}\n"],"mappings":"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","names":["component"]}