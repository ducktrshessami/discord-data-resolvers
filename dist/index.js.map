{"version":3,"sources":["../src/index.ts","../src/command-options.ts","../src/error.ts","../src/modal-fields.ts"],"sourcesContent":["export * from \"./command-options\";\nexport * from \"./modal-fields\";\n","import { APIApplicationCommandInteractionDataOption, ApplicationCommandOptionType, InteractionType } from \"discord-api-types/v10\";\nimport { ApplicationCommandOptionResolutionError } from \"./error\";\nimport { RequiredOption } from \"./util\";\n\ntype ApplicationCommandInteractionTypes = InteractionType.ApplicationCommand | InteractionType.ApplicationCommandAutocomplete;\ntype ExtractedOption<CommandInteractionType extends ApplicationCommandInteractionTypes, OptionType extends ApplicationCommandOptionType> = Extract<APIApplicationCommandInteractionDataOption<CommandInteractionType>, { type: OptionType; }>;\nexport type SubcommandOptionType = ApplicationCommandOptionType.Subcommand | ApplicationCommandOptionType.SubcommandGroup;\nexport type FocusableOptionType = Extract<APIApplicationCommandInteractionDataOption<InteractionType.ApplicationCommandAutocomplete>, { focused?: boolean }>[\"type\"];\nexport type AutocompleteFocusedOption<OptionType extends FocusableOptionType = FocusableOptionType> = Omit<ExtractedOption<InteractionType.ApplicationCommandAutocomplete, OptionType>, \"focused\"> & { focused: true };\ninterface BaseGetOptionQuery<OptionType extends ApplicationCommandOptionType> {\n    name: string;\n    type: OptionType;\n}\n\nfunction isFocusedOption(option: APIApplicationCommandInteractionDataOption): option is AutocompleteFocusedOption {\n    return \"focused\" in option && !!option.focused;\n}\n\nexport class ApplicationCommandOptions<CommandInteractionType extends ApplicationCommandInteractionTypes> {\n    private readonly _options: Map<string, APIApplicationCommandInteractionDataOption<CommandInteractionType>>;\n    private _subcommand: string | null;\n    private _group: string | null;\n    private _focused: string | null;\n\n    private mapOptions(options: APIApplicationCommandInteractionDataOption<CommandInteractionType>[] | undefined): void {\n        options?.forEach(option => {\n            switch (true) {\n                case option.type === ApplicationCommandOptionType.Subcommand: this._subcommand = option.name; break;\n                case option.type === ApplicationCommandOptionType.SubcommandGroup: this._group = option.name; break;\n                default:\n                    if (isFocusedOption(option)) {\n                        this._focused = option.name;\n                    }\n                    this._options.set(option.name, option);\n                    break;\n            }\n            if (\"options\" in option) {\n                this.mapOptions(option.options);\n            }\n        });\n    }\n\n    constructor(options?: APIApplicationCommandInteractionDataOption<CommandInteractionType>[]) {\n        this._options = new Map<string, APIApplicationCommandInteractionDataOption<CommandInteractionType>>();\n        this._subcommand = null;\n        this._group = null;\n        this._focused = null;\n        this.mapOptions(options);\n    }\n\n    get<OptionType extends Exclude<ApplicationCommandOptionType, SubcommandOptionType>>(query: BaseGetOptionQuery<OptionType> & RequiredOption<true>): ExtractedOption<CommandInteractionType, OptionType>;\n    get<OptionType extends Exclude<ApplicationCommandOptionType, SubcommandOptionType>>(query: BaseGetOptionQuery<OptionType> & Partial<RequiredOption>): ExtractedOption<CommandInteractionType, OptionType> | null;\n    get<OptionType extends Exclude<ApplicationCommandOptionType, SubcommandOptionType>>(query: BaseGetOptionQuery<OptionType> & Partial<RequiredOption>): ExtractedOption<CommandInteractionType, OptionType> | null {\n        const option = this._options.get(query.name) ?? null;\n        if (query.required && !option) {\n            throw new ApplicationCommandOptionResolutionError(`Unable to find required option: ${query.name}`);\n        }\n        if (option && option.type !== query.type) {\n            throw new ApplicationCommandOptionResolutionError(`Expected option type ${ApplicationCommandOptionType[query.type]}. Received: ${ApplicationCommandOptionType[option.type]}`);\n        }\n        return <ExtractedOption<CommandInteractionType, OptionType> | null>option;\n    }\n\n    get subcommand(): string | null {\n        return this._subcommand;\n    }\n\n    get group(): string | null {\n        return this._group;\n    }\n\n    getFocused(): AutocompleteFocusedOption {\n        if (!this._focused) {\n            throw new ApplicationCommandOptionResolutionError(\"Unabled to find focused option\");\n        }\n        return <AutocompleteFocusedOption>this._options.get(this._focused)!;\n    }\n}\n\nfunction findOption<T extends APIApplicationCommandInteractionDataOption>(\n    options: APIApplicationCommandInteractionDataOption[] | undefined,\n    test: (option: APIApplicationCommandInteractionDataOption) => option is T,\n    errIfNotFound: string\n): T;\nfunction findOption(\n    options: APIApplicationCommandInteractionDataOption[] | undefined,\n    test: (option: APIApplicationCommandInteractionDataOption) => boolean,\n    errIfNotFound: string\n): APIApplicationCommandInteractionDataOption;\nfunction findOption<T extends APIApplicationCommandInteractionDataOption>(\n    options: APIApplicationCommandInteractionDataOption[] | undefined,\n    test: (option: APIApplicationCommandInteractionDataOption) => option is T,\n    errIfNotFound?: string\n): T | null;\nfunction findOption(\n    options: APIApplicationCommandInteractionDataOption[] | undefined,\n    test: (option: APIApplicationCommandInteractionDataOption) => boolean,\n    errIfNotFound?: string\n): APIApplicationCommandInteractionDataOption | null;\nfunction findOption(\n    options: APIApplicationCommandInteractionDataOption[] | undefined,\n    test: (option: APIApplicationCommandInteractionDataOption) => boolean,\n    errIfNotFound?: string\n): APIApplicationCommandInteractionDataOption | null {\n    if (options) {\n        for (const option of options) {\n            if (test(option)) {\n                return option;\n            }\n            if (\"options\" in option) {\n                const found = findOption(option.options, test);\n                if (found) {\n                    return found;\n                }\n            }\n        }\n    }\n    if (errIfNotFound) {\n        throw new ApplicationCommandOptionResolutionError(errIfNotFound);\n    }\n    return null;\n}\n\nexport function getSubcommand(options: APIApplicationCommandInteractionDataOption[] | undefined, required: true): string;\nexport function getSubcommand(options: APIApplicationCommandInteractionDataOption[] | undefined, required?: boolean): string | null;\nexport function getSubcommand(options: APIApplicationCommandInteractionDataOption[] | undefined, required: boolean = false): string | null {\n    const subcommand = findOption(options, option => option.type === ApplicationCommandOptionType.Subcommand, required ? \"Unable to find subcommand\" : undefined);\n    return subcommand?.name ?? null;\n}\n\nexport function getGroup(options: APIApplicationCommandInteractionDataOption[] | undefined, required: true): string;\nexport function getGroup(options: APIApplicationCommandInteractionDataOption[] | undefined, required?: boolean): string | null;\nexport function getGroup(options: APIApplicationCommandInteractionDataOption[] | undefined, required: boolean = false): string | null {\n    const group = findOption(options, option => option.type === ApplicationCommandOptionType.SubcommandGroup, required ? \"Unable to find group\" : undefined);\n    return group?.name ?? null;\n}\n\nexport function getFocusedOption(options: APIApplicationCommandInteractionDataOption<InteractionType.ApplicationCommandAutocomplete>[] | undefined, required: false): AutocompleteFocusedOption | null;\nexport function getFocusedOption(options: APIApplicationCommandInteractionDataOption<InteractionType.ApplicationCommandAutocomplete>[] | undefined, required?: boolean): AutocompleteFocusedOption;\nexport function getFocusedOption(options: APIApplicationCommandInteractionDataOption<InteractionType.ApplicationCommandAutocomplete>[] | undefined, required: boolean = true): AutocompleteFocusedOption | null {\n    return findOption(options, isFocusedOption, required ? \"Unabled to find focused option\" : undefined);\n}\n","class CustomError extends Error {\n    constructor(message: string) {\n        super(message);\n        this.name = this.constructor.name;\n    }\n}\n\nexport class ApplicationCommandOptionResolutionError extends CustomError { }\nexport class ModalFieldResolutionError extends CustomError { }\n","import { APIModalSubmissionComponent, ComponentType, ModalSubmitComponent } from \"discord-api-types/v10\";\nimport { ModalFieldResolutionError } from \"./error\";\nimport { RequiredOption } from \"./util\";\n\nexport type ModalSubmitFieldType = ModalSubmitComponent[\"type\"];\ntype ExtractedField<FieldType extends ModalSubmitFieldType> = Extract<ModalSubmitComponent, { type: FieldType }>;\ninterface BaseGetFieldQuery<FieldType extends ModalSubmitFieldType> {\n    type: FieldType;\n    customId: string;\n}\n\nexport class ModalSubmitFields {\n    private readonly _fields: Map<string, ModalSubmitComponent>;\n\n    constructor(components: APIModalSubmissionComponent[]) {\n        this._fields = new Map<string, ModalSubmitComponent>();\n        for (const component of components) {\n            switch (component.type) {\n                case ComponentType.Label: this._fields.set(component.component.custom_id, component.component); break;\n                case ComponentType.ActionRow:\n                    for (const rowComponent of component.components) {\n                        this._fields.set(rowComponent.custom_id, rowComponent);\n                    }\n                    break;\n            }\n        }\n    }\n\n    get<FieldType extends ModalSubmitFieldType>(query: BaseGetFieldQuery<FieldType> & RequiredOption<false>): ExtractedField<FieldType> | null;\n    get<FieldType extends ModalSubmitFieldType>(query: BaseGetFieldQuery<FieldType> & Partial<RequiredOption>): ExtractedField<FieldType>;\n    get<FieldType extends ModalSubmitFieldType>(query: BaseGetFieldQuery<FieldType> & Partial<RequiredOption>): ExtractedField<FieldType> | null {\n        const field = this._fields.get(query.customId) ?? null;\n        if ((query.required ?? true) && !field) {\n            throw new ModalFieldResolutionError(`Unable to find required field: ${query.customId}`);\n        }\n        if (field && field.type !== query.type) {\n            throw new ModalFieldResolutionError(`Expected field type ${ComponentType[query.type]}. Received: ${ComponentType[field.type]}`);\n        }\n        return <ExtractedField<FieldType> | null>field;\n    }\n}\n"],"mappings":"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","names":["import_v10"]}